<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TRENCHER ‚Äî Solana Gem Scanner</title>
<link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300&family=JetBrains+Mono:wght@300;400;500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root {
  --bg0: #02060a;
  --bg1: #050d14;
  --bg2: #081421;
  --bg3: #0a1828;
  --line: rgba(0,180,255,0.1);
  --line2: rgba(0,180,255,0.2);
  --c: #00b4ff;
  --cg: rgba(0,180,255,0.08);
  --cdim: rgba(0,180,255,0.4);
  --og: #ff5500;
  --ogd: rgba(255,85,0,0.15);
  --gn: #00e87a;
  --gnd: rgba(0,232,122,0.12);
  --rd: #ff1f3d;
  --yw: #ffc400;
  --pu: #b06bff;
  --txt: #a8cce0;
  --txt2: #4a7a9b;
  --txt3: #1e3a50;
  --f1: 'Chakra Petch', sans-serif;
  --f2: 'JetBrains Mono', monospace;
  --gs: #ff5500;
  --ga: #ffc400;
  --gb: #00b4ff;
  --gc2: #1e3a50;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { font-size: 13px; cursor: crosshair; }
body {
  background: var(--bg0);
  color: var(--txt);
  font-family: var(--f2);
  height: 100vh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  position: relative;
}

/* ‚îÄ‚îÄ GRID BACKGROUND ‚îÄ‚îÄ */
body::before {
  content: '';
  position: fixed; inset: 0;
  background-image:
    linear-gradient(rgba(0,180,255,0.025) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,180,255,0.025) 1px, transparent 1px);
  background-size: 40px 40px;
  pointer-events: none;
  z-index: 0;
}

/* ‚îÄ‚îÄ CORNER MARKS ‚îÄ‚îÄ */
body::after {
  content: '';
  position: fixed;
  top: 8px; left: 8px;
  width: 20px; height: 20px;
  border-top: 1px solid var(--c);
  border-left: 1px solid var(--c);
  pointer-events: none;
  z-index: 10;
  opacity: 0.5;
}

/* ‚îÄ‚îÄ SCANLINE ‚îÄ‚îÄ */
#scanline {
  position: fixed;
  left: 0; right: 0;
  height: 2px;
  background: linear-gradient(90deg, transparent, rgba(0,180,255,0.15), transparent);
  pointer-events: none;
  z-index: 5;
  animation: scanDown 6s linear infinite;
}
@keyframes scanDown {
  from { top: -2px; opacity: 1; }
  to   { top: 100vh; opacity: 0.3; }
}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
header {
  position: relative;
  z-index: 20;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 20px;
  border-bottom: 1px solid var(--line2);
  background: var(--bg1);
  flex-shrink: 0;
}

.h-left { display: flex; align-items: center; gap: 20px; }

.logo {
  display: flex; align-items: center; gap: 10px;
  font-family: var(--f1);
  font-weight: 700;
  font-size: 16px;
  letter-spacing: 4px;
  color: #fff;
}
.logo-icon {
  width: 28px; height: 28px;
  position: relative;
  flex-shrink: 0;
}
.logo-icon svg { width: 100%; height: 100%; }

.h-tag {
  font-size: 9px;
  letter-spacing: 2px;
  color: var(--txt3);
  border-left: 1px solid var(--line2);
  padding-left: 16px;
  font-family: var(--f1);
}

.h-right { display: flex; align-items: center; gap: 20px; }

.status-pill {
  display: flex; align-items: center; gap: 6px;
  font-size: 10px; letter-spacing: 2px;
  color: var(--gn);
  font-family: var(--f1);
}
.status-dot {
  width: 6px; height: 6px;
  background: var(--gn);
  border-radius: 50%;
  box-shadow: 0 0 6px var(--gn);
  animation: blink 2s ease-in-out infinite;
}
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

#clock {
  font-family: var(--f2);
  font-size: 11px;
  color: var(--txt2);
  letter-spacing: 1px;
}

.tg-link {
  display: flex; align-items: center; gap: 6px;
  padding: 5px 14px;
  border: 1px solid var(--line2);
  color: var(--cdim);
  font-size: 10px; letter-spacing: 2px;
  text-decoration: none;
  font-family: var(--f1);
  transition: all 0.2s;
  background: var(--cg);
}
.tg-link:hover { border-color: var(--c); color: var(--c); box-shadow: 0 0 12px rgba(0,180,255,0.2); }

/* ‚îÄ‚îÄ STATS ROW ‚îÄ‚îÄ */
.stats-row {
  position: relative; z-index: 20;
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  border-bottom: 1px solid var(--line);
  background: var(--bg1);
  flex-shrink: 0;
}
.stat {
  padding: 10px 16px;
  border-right: 1px solid var(--line);
  position: relative;
  overflow: hidden;
}
.stat:last-child { border-right: none; }
.stat::after {
  content: '';
  position: absolute;
  bottom: 0; left: 50%; right: 50%;
  height: 1px;
  background: var(--c);
  transition: all 0.4s ease;
  opacity: 0;
}
.stat:hover::after { left: 0; right: 0; opacity: 1; }
.sv {
  font-family: var(--f1);
  font-size: 20px;
  font-weight: 700;
  line-height: 1;
}
.sl { font-size: 8px; letter-spacing: 2px; color: var(--txt3); margin-top: 3px; font-family: var(--f1); }

/* ‚îÄ‚îÄ MAIN 3-COL LAYOUT ‚îÄ‚îÄ */
.main {
  position: relative; z-index: 10;
  display: grid;
  grid-template-columns: 280px 1fr 300px;
  flex: 1;
  overflow: hidden;
  min-height: 0;
}

/* ‚îÄ‚îÄ LEFT: CA SCANNER ‚îÄ‚îÄ */
.ca-panel {
  border-right: 1px solid var(--line);
  display: flex;
  flex-direction: column;
  background: var(--bg1);
  overflow: hidden;
}

.panel-hdr {
  padding: 10px 14px;
  border-bottom: 1px solid var(--line);
  display: flex; align-items: center; gap: 8px;
  background: var(--bg2);
  flex-shrink: 0;
}
.panel-hdr-title {
  font-family: var(--f1);
  font-size: 9px;
  letter-spacing: 2px;
  color: var(--c);
  flex: 1;
}
.hdr-dot {
  width: 5px; height: 5px;
  background: var(--c);
  transform: rotate(45deg);
  box-shadow: 0 0 6px var(--c);
  flex-shrink: 0;
}

.ca-body {
  padding: 12px;
  flex: 1;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.ca-body::-webkit-scrollbar { width: 2px; }
.ca-body::-webkit-scrollbar-thumb { background: var(--line2); }

.ca-label {
  font-size: 8px;
  letter-spacing: 2px;
  color: var(--txt3);
  font-family: var(--f1);
  margin-bottom: 4px;
}

.ca-input-wrap { display: flex; flex-direction: column; gap: 6px; }

#ca-input {
  width: 100%;
  background: var(--bg0);
  border: 1px solid var(--line2);
  color: #fff;
  padding: 9px 10px;
  font-family: var(--f2);
  font-size: 10px;
  outline: none;
  transition: all 0.2s;
  resize: none;
  height: 60px;
}
#ca-input:focus { border-color: var(--c); box-shadow: 0 0 0 1px var(--c) inset; }
#ca-input::placeholder { color: var(--txt3); }

#ca-btn {
  width: 100%;
  padding: 9px;
  background: var(--cg);
  border: 1px solid var(--c);
  color: var(--c);
  font-family: var(--f1);
  font-size: 10px;
  letter-spacing: 2px;
  cursor: crosshair;
  transition: all 0.2s;
  font-weight: 600;
}
#ca-btn:hover:not(:disabled) { background: rgba(0,180,255,0.15); box-shadow: 0 0 16px rgba(0,180,255,0.2); }
#ca-btn:disabled { opacity: 0.4; }

.divider {
  height: 1px;
  background: var(--line);
  margin: 4px 0;
}

/* CA result styles */
.ca-result-hdr {
  display: flex; align-items: center; gap: 8px;
  padding: 10px;
  background: var(--bg2);
  border: 1px solid var(--line);
}
.ca-grade {
  width: 36px; height: 36px;
  display: flex; align-items: center; justify-content: center;
  font-family: var(--f1); font-weight: 700; font-size: 16px;
  clip-path: polygon(50% 0%,100% 50%,50% 100%,0% 50%);
  flex-shrink: 0;
}
.ca-sym { font-family: var(--f1); font-size: 14px; font-weight: 700; color: #fff; }
.ca-nm  { font-size: 9px; color: var(--txt2); margin-top: 1px; }
.ca-score-big { font-family: var(--f1); font-size: 22px; font-weight: 700; margin-left: auto; }

.ca-bar-wrap { padding: 8px 10px; background: var(--bg2); border: 1px solid var(--line); border-top: none; }
.ca-bar-track { height: 3px; background: rgba(255,255,255,0.06); }
.ca-bar-fill  { height: 100%; transition: width 0.8s cubic-bezier(0.34,1.56,0.64,1); }

.ca-stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1px; background: var(--line); border: 1px solid var(--line); }
.ca-stat-cell { background: var(--bg2); padding: 7px 9px; }
.ca-stat-lbl { font-size: 7px; letter-spacing: 1.5px; color: var(--txt3); margin-bottom: 2px; }
.ca-stat-val { font-family: var(--f1); font-size: 12px; font-weight: 600; }

.ca-flags { display: flex; flex-wrap: wrap; gap: 4px; }
.flag {
  font-size: 8px; padding: 2px 6px;
  border-radius: 1px; border: 1px solid;
  font-family: var(--f1); letter-spacing: 0.5px;
}
.flag-s  { border-color: rgba(255,85,0,0.4);   color: var(--og); background: rgba(255,85,0,0.06); }
.flag-b  { border-color: rgba(0,232,122,0.3);  color: var(--gn); background: rgba(0,232,122,0.05); }
.flag-c  { border-color: rgba(0,180,255,0.3);  color: var(--c);  background: rgba(0,180,255,0.05); }
.flag-d  { border-color: var(--txt3);           color: var(--txt2); background: transparent; }

.ca-links { display: flex; flex-wrap: wrap; gap: 4px; }
.ca-link {
  font-size: 8px; padding: 4px 8px;
  border: 1px solid var(--line2);
  color: var(--txt2);
  text-decoration: none;
  font-family: var(--f1);
  letter-spacing: 1px;
  transition: all 0.15s;
}
.ca-link:hover { border-color: var(--c); color: var(--c); }

.ca-warn { font-size: 9px; color: var(--rd); padding: 6px 8px; border: 1px solid rgba(255,31,61,0.2); background: rgba(255,31,61,0.05); }

.ca-empty {
  flex: 1;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  gap: 8px;
  color: var(--txt3);
  text-align: center;
  padding: 20px;
}
.ca-empty-icon {
  width: 40px; height: 40px;
  border: 1px solid var(--txt3);
  transform: rotate(45deg);
  display: flex; align-items: center; justify-content: center;
  animation: rotPulse 4s ease-in-out infinite;
}
.ca-empty-icon span { transform: rotate(-45deg); font-size: 16px; }
@keyframes rotPulse { 0%,100%{opacity:0.3;transform:rotate(45deg) scale(1)} 50%{opacity:0.6;transform:rotate(45deg) scale(1.05)} }
.ca-empty-txt { font-family: var(--f1); font-size: 9px; letter-spacing: 2px; }

/* ‚îÄ‚îÄ CENTER: LIVE FEED ‚îÄ‚îÄ */
.feed-panel {
  display: flex;
  flex-direction: column;
  overflow: hidden;
  border-right: 1px solid var(--line);
}

.feed-controls {
  padding: 8px 14px;
  border-bottom: 1px solid var(--line);
  display: flex; align-items: center; gap: 8px;
  background: var(--bg2);
  flex-shrink: 0;
}

.grade-btn {
  padding: 3px 10px;
  background: transparent;
  border: 1px solid var(--line2);
  color: var(--txt3);
  font-family: var(--f1);
  font-size: 9px;
  letter-spacing: 1px;
  cursor: crosshair;
  transition: all 0.15s;
  font-weight: 600;
}
.grade-btn:hover { color: var(--txt); border-color: var(--txt2); }
.grade-btn.on-all { border-color: var(--c); color: var(--c); background: var(--cg); }
.grade-btn.on-S   { border-color: var(--og); color: var(--og); background: var(--ogd); }
.grade-btn.on-A   { border-color: var(--yw); color: var(--yw); background: rgba(255,196,0,0.08); }
.grade-btn.on-B   { border-color: var(--gb); color: var(--gb); background: var(--cg); }

.token-count { margin-left: auto; font-size: 9px; color: var(--txt3); font-family: var(--f1); letter-spacing: 1px; }

/* Table */
.tbl-head {
  display: grid;
  grid-template-columns: 36px 1fr 55px 90px 75px 80px 80px 60px;
  padding: 7px 14px;
  border-bottom: 1px solid var(--line);
  font-size: 8px; letter-spacing: 1.5px;
  color: var(--txt3);
  background: var(--bg2);
  flex-shrink: 0;
  font-family: var(--f1);
}
.th { display: flex; align-items: center; }
.th.r { justify-content: flex-end; }

.token-list { overflow-y: auto; flex: 1; }
.token-list::-webkit-scrollbar { width: 2px; }
.token-list::-webkit-scrollbar-thumb { background: var(--line2); }

.trow {
  display: grid;
  grid-template-columns: 36px 1fr 55px 90px 75px 80px 80px 60px;
  padding: 9px 14px;
  border-bottom: 1px solid rgba(0,180,255,0.04);
  cursor: crosshair;
  transition: background 0.12s;
  position: relative;
  animation: rowIn 0.3s ease both;
}
@keyframes rowIn { from { opacity:0; transform:translateX(-6px); } to { opacity:1; transform:translateX(0); } }
.trow::before {
  content: '';
  position: absolute;
  left: 0; top: 0; bottom: 0;
  width: 2px;
  opacity: 0;
  transition: opacity 0.15s;
}
.trow:hover { background: rgba(0,180,255,0.03); }
.trow:hover::before { opacity: 1; }
.trow.g-S::before { background: var(--gs); }
.trow.g-A::before { background: var(--ga); }
.trow.g-B::before { background: var(--gb); }
.trow.g-C::before { background: var(--gc2); }
.trow.fresh { animation: freshIn 0.4s ease both; }
@keyframes freshIn { from{background:rgba(255,85,0,0.08);transform:translateX(-4px)} to{background:transparent;transform:translateX(0)} }

.gbadge {
  width: 28px; height: 28px;
  display: flex; align-items: center; justify-content: center;
  font-family: var(--f1); font-weight: 700; font-size: 12px;
  clip-path: polygon(50% 0%,100% 50%,50% 100%,0% 50%);
}
.gbadge.S { background:rgba(255,85,0,0.2);  color:var(--gs); }
.gbadge.A { background:rgba(255,196,0,0.15); color:var(--ga); }
.gbadge.B { background:rgba(0,180,255,0.1);  color:var(--gb); }
.gbadge.C { background:rgba(30,58,80,0.3);   color:var(--gc2); }

.tcell { display: flex; align-items: center; font-size: 11px; }
.tcell.r { justify-content: flex-end; }
.tcell.c { justify-content: center; }

.tname { display: flex; flex-direction: column; gap: 2px; justify-content: center; overflow: hidden; }
.tsym { font-family: var(--f1); font-size: 12px; font-weight: 600; color: #fff; white-space: nowrap; }
.tflags { display: flex; gap: 2px; flex-wrap: wrap; }
.tf { font-size: 7px; padding: 1px 4px; border: 1px solid var(--line2); color: var(--txt2); font-family: var(--f1); white-space: nowrap; }

.score-col { display: flex; flex-direction: column; align-items: flex-end; gap: 2px; }
.sc-num { font-family: var(--f1); font-size: 12px; font-weight: 700; }
.sc-bar { width: 32px; height: 2px; background: rgba(255,255,255,0.06); }
.sc-fill { height: 100%; }

.chg { font-family: var(--f1); font-size: 11px; font-weight: 600; }
.pos { color: var(--gn); }
.neg { color: var(--rd); }
.neu { color: var(--txt3); }

.bs { display: flex; align-items: center; gap: 3px; font-family: var(--f1); font-size: 11px; }

.age-col { font-size: 10px; color: var(--txt2); font-family: var(--f1); }
.age-hot { color: var(--og); animation: ageBlink 1.5s ease-in-out infinite; }
@keyframes ageBlink { 0%,100%{opacity:1} 50%{opacity:0.4} }

.feed-empty {
  flex: 1;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  gap: 16px; color: var(--txt3);
}
.radar-wrap { position: relative; width: 80px; height: 80px; }
.radar-ring {
  position: absolute; border: 1px solid var(--c);
  border-radius: 50%; opacity: 0;
  animation: radarPulse 2.5s ease-out infinite;
}
.radar-ring:nth-child(1) { inset: 0;   animation-delay: 0s; }
.radar-ring:nth-child(2) { inset: 18px; animation-delay: 0.6s; }
.radar-ring:nth-child(3) { inset: 36px; animation-delay: 1.2s; }
@keyframes radarPulse { 0%{opacity:0.7;transform:scale(0.6)} 100%{opacity:0;transform:scale(1.4)} }
.feed-empty-txt { font-family: var(--f1); font-size: 10px; letter-spacing: 3px; }

/* ‚îÄ‚îÄ RIGHT: ALERT HISTORY ‚îÄ‚îÄ */
.alert-panel {
  display: flex;
  flex-direction: column;
  overflow: hidden;
  background: var(--bg1);
}

.alert-list { overflow-y: auto; flex: 1; }
.alert-list::-webkit-scrollbar { width: 2px; }
.alert-list::-webkit-scrollbar-thumb { background: var(--line2); }

.acard {
  padding: 12px 14px;
  border-bottom: 1px solid rgba(0,180,255,0.05);
  cursor: crosshair;
  transition: background 0.12s;
  position: relative;
  animation: aIn 0.3s ease both;
}
@keyframes aIn { from{opacity:0;transform:translateX(6px)} to{opacity:1;transform:translateX(0)} }
.acard:hover { background: rgba(0,180,255,0.03); }
.acard.as { border-left: 2px solid var(--og); }
.acard.aa { border-left: 2px solid var(--ga); }

.atop { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
.asym { font-family: var(--f1); font-size: 13px; font-weight: 700; color: #fff; }
.abadge { font-family: var(--f1); font-weight: 700; font-size: 10px; padding: 2px 7px; }
.abadge.S { background: rgba(255,85,0,0.15); color: var(--og); }
.abadge.A { background: rgba(255,196,0,0.1); color: var(--ga); }

.ameta { display: flex; justify-content: space-between; font-size: 9px; color: var(--txt3); margin-bottom: 6px; }

.abar { height: 2px; background: rgba(255,255,255,0.05); margin-bottom: 6px; }
.abar-fill { height: 100%; }

.alinks { display: flex; gap: 4px; }
.alink { font-size: 8px; padding: 2px 6px; border: 1px solid var(--line2); color: var(--txt2); text-decoration: none; font-family: var(--f1); letter-spacing: 1px; transition: all 0.15s; }
.alink:hover { border-color: var(--c); color: var(--c); }

.alert-empty {
  flex: 1;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  gap: 10px; color: var(--txt3);
}
.ae-icon { font-size: 24px; opacity: 0.3; animation: aePulse 3s ease-in-out infinite; }
@keyframes aePulse { 0%,100%{opacity:0.2} 50%{opacity:0.5} }
.ae-txt { font-family: var(--f1); font-size: 9px; letter-spacing: 2px; }

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
#modal-bg {
  position: fixed; inset: 0;
  background: rgba(2,6,10,0.92);
  backdrop-filter: blur(4px);
  z-index: 500;
  display: none;
  align-items: center; justify-content: center;
  padding: 20px;
}
#modal-bg.open { display: flex; }
#modal {
  background: var(--bg2);
  border: 1px solid var(--line2);
  width: 100%; max-width: 560px;
  max-height: 88vh;
  overflow-y: auto;
  animation: mIn 0.25s ease;
  position: relative;
}
#modal::-webkit-scrollbar { width: 2px; }
#modal::-webkit-scrollbar-thumb { background: var(--line2); }
@keyframes mIn { from{opacity:0;transform:scale(0.97)} to{opacity:1;transform:scale(1)} }
.m-close { position: absolute; top: 12px; right: 14px; background: none; border: none; color: var(--txt3); font-size: 14px; cursor: crosshair; transition: color 0.15s; font-family: var(--f2); }
.m-close:hover { color: var(--rd); }
.m-hdr { padding: 18px 20px; border-bottom: 1px solid var(--line); display: flex; align-items: center; gap: 14px; }
.m-grade { width: 52px; height: 52px; display: flex; align-items: center; justify-content: center; font-family: var(--f1); font-size: 24px; font-weight: 700; clip-path: polygon(50% 0%,100% 50%,50% 100%,0% 50%); flex-shrink: 0; }
.m-sym { font-family: var(--f1); font-size: 22px; font-weight: 700; color: #fff; }
.m-name { font-size: 11px; color: var(--txt2); }
.m-addr { font-size: 9px; color: var(--txt3); margin-top: 3px; word-break: break-all; }
.m-score-section { padding: 14px 20px; border-bottom: 1px solid var(--line); }
.m-score-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 9px; letter-spacing: 2px; color: var(--txt3); font-family: var(--f1); }
.m-score-val { font-family: var(--f1); font-size: 18px; font-weight: 700; }
.m-bar { height: 4px; background: rgba(255,255,255,0.06); }
.m-bar-fill { height: 100%; transition: width 0.8s cubic-bezier(0.34,1.56,0.64,1); }
.m-flags { padding: 12px 20px; border-bottom: 1px solid var(--line); display: flex; flex-wrap: wrap; gap: 5px; }
.m-stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1px; background: var(--line); }
.m-stat { background: var(--bg2); padding: 12px 14px; }
.m-stat-lbl { font-size: 8px; letter-spacing: 2px; color: var(--txt3); margin-bottom: 4px; font-family: var(--f1); }
.m-stat-val { font-family: var(--f1); font-size: 14px; font-weight: 600; }
.m-links { padding: 14px 20px; display: flex; gap: 8px; flex-wrap: wrap; }
.m-link { padding: 6px 12px; border: 1px solid var(--line2); color: var(--txt2); font-size: 10px; text-decoration: none; font-family: var(--f1); letter-spacing: 1px; transition: all 0.15s; }
.m-link:hover { border-color: var(--c); color: var(--c); box-shadow: 0 0 8px rgba(0,180,255,0.15); }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
#toasts {
  position: fixed; top: 60px; right: 16px;
  z-index: 1000;
  display: flex; flex-direction: column; gap: 6px;
  pointer-events: none;
}
.toast {
  padding: 10px 14px;
  background: var(--bg2);
  border: 1px solid;
  font-size: 11px; font-family: var(--f1); letter-spacing: 1px;
  max-width: 280px;
  animation: tIn 0.3s ease, tOut 0.3s ease 3.7s forwards;
}
.toast.S { border-color: var(--og); color: var(--og); background: rgba(255,85,0,0.08); }
.toast.A { border-color: var(--ga); color: var(--ga); background: rgba(255,196,0,0.06); }
@keyframes tIn  { from{opacity:0;transform:translateX(16px)} to{opacity:1;transform:translateX(0)} }
@keyframes tOut { from{opacity:1} to{opacity:0;transform:translateX(16px)} }

/* ‚îÄ‚îÄ CORNER DECORATIONS ‚îÄ‚îÄ */
.corner { position: fixed; pointer-events: none; z-index: 3; }
.corner.br { bottom: 8px; right: 8px; width: 20px; height: 20px; border-bottom: 1px solid rgba(0,180,255,0.3); border-right: 1px solid rgba(0,180,255,0.3); }
.corner.tr { top: 8px; right: 8px; width: 20px; height: 20px; border-top: 1px solid rgba(0,180,255,0.3); border-right: 1px solid rgba(0,180,255,0.3); }
</style>
</head>
<body>

<div id="scanline"></div>
<div class="corner br"></div>
<div class="corner tr"></div>
<div id="toasts"></div>

<!-- HEADER -->
<header>
  <div class="h-left">
    <div class="logo">
      <div class="logo-icon">
        <svg viewBox="0 0 28 28" fill="none">
          <polygon points="14,2 26,14 14,26 2,14" stroke="#00b4ff" stroke-width="1" fill="rgba(0,180,255,0.05)"/>
          <polygon points="14,7 21,14 14,21 7,14" stroke="#ff5500" stroke-width="1" fill="none" opacity="0.7"/>
          <circle cx="14" cy="14" r="2" fill="#00b4ff"/>
        </svg>
      </div>
      TRENCHER
    </div>
    <div class="h-tag">SOLANA GEM SCANNER</div>
  </div>
  <div class="h-right">
    <div class="status-pill"><div class="status-dot"></div>ONLINE</div>
    <div id="clock">--:--:-- UTC</div>
    <a href="https://t.me/trencheralertbot" target="_blank" class="tg-link">‚úà @TRENCHERALERTBOT</a>
  </div>
</header>

<!-- STATS ROW -->
<div class="stats-row">
  <div class="stat"><div class="sv" id="s-total" style="color:var(--c)">0</div><div class="sl">SCANNED</div></div>
  <div class="stat"><div class="sv" id="s-s" style="color:var(--og)">0</div><div class="sl">GRADE S</div></div>
  <div class="stat"><div class="sv" id="s-a" style="color:var(--ga)">0</div><div class="sl">GRADE A</div></div>
  <div class="stat"><div class="sv" id="s-b" style="color:var(--gb)">0</div><div class="sl">GRADE B</div></div>
  <div class="stat"><div class="sv" id="s-avg" style="color:var(--gn)">0</div><div class="sl">AVG SCORE</div></div>
  <div class="stat"><div class="sv" id="s-alerts" style="color:var(--pu)">0</div><div class="sl">ALERTS</div></div>
  <div class="stat"><div class="sv" id="s-time" style="color:var(--gn);font-size:12px">LIVE</div><div class="sl">STATUS</div></div>
</div>

<!-- MAIN -->
<div class="main">

  <!-- LEFT: CA SCANNER -->
  <div class="ca-panel">
    <div class="panel-hdr">
      <div class="hdr-dot"></div>
      <div class="panel-hdr-title">CA SCANNER</div>
    </div>
    <div class="ca-body">
      <div>
        <div class="ca-label">CONTRACT ADDRESS</div>
        <div class="ca-input-wrap">
          <textarea id="ca-input" placeholder="Paste Solana CA here...&#10;Press Ctrl+Enter to scan" onkeydown="if((event.ctrlKey||event.metaKey)&&event.key==='Enter')analyzeCA()"></textarea>
          <button id="ca-btn" onclick="analyzeCA()">‚¨° ANALYZE TOKEN</button>
        </div>
      </div>
      <div class="divider"></div>
      <div id="ca-result">
        <div class="ca-empty">
          <div class="ca-empty-icon"><span>‚¨°</span></div>
          <div class="ca-empty-txt">AWAITING INPUT</div>
          <div style="font-size:8px;color:var(--txt3);letter-spacing:1px;margin-top:4px;">paste CA ‚Üí analyze</div>
        </div>
      </div>
    </div>
  </div>

  <!-- CENTER: LIVE FEED -->
  <div class="feed-panel">
    <div class="panel-hdr">
      <div class="hdr-dot"></div>
      <div class="panel-hdr-title">LIVE TOKEN FEED</div>
    </div>
    <div class="feed-controls">
      <button class="grade-btn on-all" onclick="setFilter('ALL',this)">ALL</button>
      <button class="grade-btn" onclick="setFilter('S',this)">GRADE S</button>
      <button class="grade-btn" onclick="setFilter('A',this)">GRADE A</button>
      <button class="grade-btn" onclick="setFilter('B',this)">GRADE B</button>
      <div class="token-count" id="token-count">0 tokens</div>
    </div>
    <div class="tbl-head">
      <div class="th">GRD</div>
      <div class="th">TOKEN</div>
      <div class="th r">SCR</div>
      <div class="th r">PRICE</div>
      <div class="th r">5M%</div>
      <div class="th r">FDV</div>
      <div class="th r">B/S</div>
      <div class="th r">AGE</div>
    </div>
    <div class="token-list" id="token-list">
      <div class="feed-empty">
        <div class="radar-wrap">
          <div class="radar-ring"></div>
          <div class="radar-ring"></div>
          <div class="radar-ring"></div>
        </div>
        <div class="feed-empty-txt">SCANNING TRENCHES</div>
        <div style="font-size:9px;color:var(--txt3)">awaiting scanner data...</div>
      </div>
    </div>
  </div>

  <!-- RIGHT: ALERT HISTORY -->
  <div class="alert-panel">
    <div class="panel-hdr">
      <div class="hdr-dot" style="background:var(--og);box-shadow:0 0 6px var(--og)"></div>
      <div class="panel-hdr-title">ALERT HISTORY</div>
      <div style="font-size:8px;color:var(--txt3);font-family:var(--f1)">S + A ONLY</div>
    </div>
    <div class="alert-list" id="alert-list">
      <div class="alert-empty">
        <div class="ae-icon">üì°</div>
        <div class="ae-txt">NO ALERTS YET</div>
      </div>
    </div>
  </div>

</div>

<!-- MODAL -->
<div id="modal-bg" onclick="closeMod(event)">
  <div id="modal">
    <button class="m-close" onclick="closeMod()">‚úï</button>
    <div id="modal-inner"></div>
  </div>
</div>

<script>
// ‚ïê‚ïê CONFIG ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SB_URL = 'https://wwlomifjbgblcvjhggdb.supabase.co';
const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind3bG9taWZqYmdibGN2amhnZ2RiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExODQ0MzQsImV4cCI6MjA4Njc2MDQzNH0.2_w4SV9tJcF5XcSSunrqKiI0SgPcgjuKbtSvjPsR_Mg';
const sb = supabase.createClient(SB_URL, SB_KEY);

// ‚ïê‚ïê CLOCK ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
setInterval(() => {
  document.getElementById('clock').textContent = new Date().toUTCString().slice(17,25) + ' UTC';
}, 1000);

// ‚ïê‚ïê STATE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let tokens = [], alerts = [], filter = 'ALL';

// ‚ïê‚ïê LOAD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function load() {
  const [{ data: t }, { data: a }] = await Promise.all([
    sb.from('tokens').select('*').order('scored_at', { ascending: false }).limit(200),
    sb.from('alerts').select('*').order('alerted_at', { ascending: false }).limit(50)
  ]);
  if (t) { tokens = t; renderFeed(); updateStats(); }
  if (a) { alerts = a; renderAlerts(); }
}

// ‚ïê‚ïê REALTIME ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
sb.channel('live')
  .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'tokens' }, ({ new: r }) => {
    tokens.unshift(r); if (tokens.length > 200) tokens.pop();
    renderFeed(); updateStats(); toast(r);
  })
  .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'tokens' }, ({ new: r }) => {
    const i = tokens.findIndex(t => t.address === r.address);
    if (i >= 0) tokens[i] = r; else tokens.unshift(r);
    renderFeed(); updateStats();
  })
  .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'alerts' }, ({ new: r }) => {
    alerts.unshift(r); renderAlerts();
  })
  .subscribe();

load();

// ‚ïê‚ïê RENDER FEED ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setFilter(f, btn) {
  filter = f;
  document.querySelectorAll('.grade-btn').forEach(b => b.className = 'grade-btn');
  if (btn) btn.className = 'grade-btn on-' + f;
  renderFeed();
}

function renderFeed() {
  const list = document.getElementById('token-list');
  const filtered = filter === 'ALL' ? tokens : tokens.filter(t => t.grade === filter);
  document.getElementById('token-count').textContent = filtered.length + ' tokens';

  if (!filtered.length) {
    list.innerHTML = `<div class="feed-empty"><div class="radar-wrap"><div class="radar-ring"></div><div class="radar-ring"></div><div class="radar-ring"></div></div><div class="feed-empty-txt">SCANNING TRENCHES</div><div style="font-size:9px;color:var(--txt3)">awaiting grade ${filter} signals...</div></div>`;
    return;
  }

  list.innerHTML = filtered.map((t, i) => {
    const gc = gcolor(t.grade);
    const ageMin = t.pair_created_at ? Math.floor((Date.now() - new Date(t.pair_created_at)) / 60000) : null;
    const ageStr = ageMin === null ? '?' : ageMin < 60 ? ageMin + 'm' : Math.floor(ageMin/60) + 'h';
    const fresh = ageMin !== null && ageMin < 8;
    const isNew = i === 0 && (Date.now() - new Date(t.scored_at)) < 30000;
    return `<div class="trow g-${t.grade} ${isNew ? 'fresh' : ''}" onclick="openMod('${t.address}')" style="animation-delay:${Math.min(i*0.015,0.4)}s">
      <div class="tcell c"><div class="gbadge ${t.grade}">${t.grade}</div></div>
      <div class="tcell">
        <div class="tname">
          <div class="tsym">${esc(t.symbol||'???')}</div>
          <div class="tflags">${(t.flags||[]).slice(0,2).map(f=>`<span class="tf">${f.replace(/_/g,' ')}</span>`).join('')}</div>
        </div>
      </div>
      <div class="tcell r">
        <div class="score-col">
          <div class="sc-num" style="color:${gc}">${t.score}</div>
          <div class="sc-bar"><div class="sc-fill" style="width:${t.score}%;background:${gc}"></div></div>
        </div>
      </div>
      <div class="tcell r" style="font-family:var(--f2);font-size:10px;">${fmtP(t.price_usd)}</div>
      <div class="tcell r"><span class="chg ${chgCls(t.price_change_5m)}">${fmtC(t.price_change_5m)}</span></div>
      <div class="tcell r" style="font-size:10px;color:var(--txt2)">${fmtL(t.fdv)}</div>
      <div class="tcell r"><div class="bs"><span style="color:var(--gn)">${t.buys_5m||0}</span><span style="color:var(--txt3);font-size:9px">/</span><span style="color:var(--rd)">${t.sells_5m||0}</span></div></div>
      <div class="tcell r"><span class="age-col ${fresh?'age-hot':''}">${ageStr}</span></div>
    </div>`;
  }).join('');
}

// ‚ïê‚ïê RENDER ALERTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderAlerts() {
  const list = document.getElementById('alert-list');
  const f = alerts.filter(a => a.grade === 'S' || a.grade === 'A');
  document.getElementById('s-alerts').textContent = f.length;

  if (!f.length) {
    list.innerHTML = `<div class="alert-empty"><div class="ae-icon">üì°</div><div class="ae-txt">NO ALERTS YET</div></div>`;
    return;
  }

  list.innerHTML = f.map((a, i) => {
    const gc = gcolor(a.grade);
    return `<div class="acard a${a.grade.toLowerCase()}" style="animation-delay:${Math.min(i*0.03,0.5)}s">
      <div class="atop">
        <span class="asym">${esc(a.token_symbol||'???')}</span>
        <span class="abadge ${a.grade}">${a.grade} ‚Äî ${a.score}</span>
      </div>
      <div class="ameta"><span>${timeAgo(a.alerted_at)}</span><span style="color:${gc}">${a.score}/100</span></div>
      <div class="abar"><div class="abar-fill" style="width:${a.score}%;background:${gc}"></div></div>
      <div style="margin-bottom:6px;display:flex;flex-wrap:wrap;gap:3px;">${(a.flags||[]).slice(0,3).map(f=>`<span style="font-size:7px;padding:1px 4px;border:1px solid var(--line2);color:var(--txt2);font-family:var(--f1)">${f.replace(/_/g,' ')}</span>`).join('')}</div>
      <div class="alinks">
        <a class="alink" href="https://pump.fun/${a.token_address}" target="_blank">PUMP</a>
        <a class="alink" href="https://dexscreener.com/solana/${a.token_address}" target="_blank">CHART</a>
        <a class="alink" href="https://solscan.io/token/${a.token_address}" target="_blank">SCAN</a>
      </div>
    </div>`;
  }).join('');
}

// ‚ïê‚ïê STATS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateStats() {
  const avg = tokens.length ? Math.round(tokens.reduce((s,t)=>s+(t.score||0),0)/tokens.length) : 0;
  anim('s-total', tokens.length);
  anim('s-s', tokens.filter(t=>t.grade==='S').length);
  anim('s-a', tokens.filter(t=>t.grade==='A').length);
  anim('s-b', tokens.filter(t=>t.grade==='B').length);
  anim('s-avg', avg);
}

function anim(id, target) {
  const el = document.getElementById(id);
  if (!el) return;
  const cur = parseInt(el.textContent) || 0;
  if (cur === target) return;
  const step = (target - cur) / 12;
  let v = cur;
  const tick = () => {
    v += step;
    el.textContent = Math.round(v);
    if (Math.abs(v - target) > 0.5) requestAnimationFrame(tick);
    else el.textContent = target;
  };
  requestAnimationFrame(tick);
}

// ‚ïê‚ïê MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openMod(addr) {
  const t = tokens.find(x => x.address === addr);
  if (!t) return;
  const gc = gcolor(t.grade);
  document.getElementById('modal-inner').innerHTML = `
    <div class="m-hdr">
      ${t.image_url ? `<img src="${t.image_url}" style="width:44px;height:44px;border-radius:50%;border:1px solid ${gc}30" onerror="this.style.display='none'">` : ''}
      <div class="m-grade ${t.grade}" style="background:${gc}15;color:${gc};">${t.grade}</div>
      <div>
        <div class="m-sym">${esc(t.symbol||'???')}</div>
        <div class="m-name">${esc(t.name||'Unknown')}</div>
        <div class="m-addr">${t.address}</div>
      </div>
    </div>
    <div class="m-score-section">
      <div class="m-score-row"><span>SIGNAL SCORE</span><span class="m-score-val" style="color:${gc}">${t.score}/100</span></div>
      <div class="m-bar"><div class="m-bar-fill" id="mbar" style="width:0%;background:${gc}"></div></div>
    </div>
    <div class="m-flags">${(t.flags||[]).map(f=>`<span class="flag ${getFlagCls(f)}">${f.replace(/_/g,' ')}</span>`).join('')}</div>
    <div class="m-stats">
      ${[['PRICE',fmtP(t.price_usd),null],['5M CHG',fmtC(t.price_change_5m),chgColor(t.price_change_5m)],['1H CHG',fmtC(t.price_change_1h),chgColor(t.price_change_1h)],['FDV',fmtL(t.fdv),null],['LIQUIDITY',fmtL(t.liquidity_usd),t.liquidity_usd>50000?'var(--gn)':t.liquidity_usd<5000?'var(--rd)':null],['VOL 1H',fmtL(t.volume_1h),null],['BUYS 5M',t.buys_5m||0,'var(--gn)'],['SELLS 5M',t.sells_5m||0,'var(--rd)'],['BUY %',((t.buy_ratio_5m||0.5)*100).toFixed(0)+'%',t.buy_ratio_5m>0.65?'var(--gn)':t.buy_ratio_5m<0.35?'var(--rd)':null],['HOLDERS',t.holder_count||'?',null],['TOP 10%',(t.top10_pct||0).toFixed(1)+'%',null],['SMART $',t.smart_money_count||0,t.smart_money_count>0?'var(--pu)':null]].map(([l,v,c])=>`<div class="m-stat"><div class="m-stat-lbl">${l}</div><div class="m-stat-val" style="color:${c||'var(--txt)'}">${v}</div></div>`).join('')}
    </div>
    <div class="m-links">
      <a class="m-link" href="https://pump.fun/${t.address}" target="_blank">üîó PUMP.FUN</a>
      <a class="m-link" href="${t.dex_url||'https://dexscreener.com/solana/'+t.address}" target="_blank">üìä DEXSCREENER</a>
      <a class="m-link" href="https://solscan.io/token/${t.address}" target="_blank">üîé SOLSCAN</a>
      <a class="m-link" href="https://birdeye.so/token/${t.address}?chain=solana" target="_blank">üëÅ BIRDEYE</a>
      <a class="m-link" href="https://rugcheck.xyz/tokens/${t.address}" target="_blank">üõ° RUGCHECK</a>
    </div>
  `;
  document.getElementById('modal-bg').classList.add('open');
  setTimeout(() => { const b = document.getElementById('mbar'); if(b) b.style.width = t.score + '%'; }, 100);
}

function closeMod(e) {
  if (!e || e.target === document.getElementById('modal-bg') || e.currentTarget.tagName==='BUTTON') {
    document.getElementById('modal-bg').classList.remove('open');
  }
}
document.addEventListener('keydown', e => { if(e.key==='Escape') closeMod(); });

// ‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toast(token) {
  if (token.grade !== 'S' && token.grade !== 'A') return;
  const c = document.getElementById('toasts');
  const t = document.createElement('div');
  t.className = `toast ${token.grade}`;
  t.textContent = `${token.grade==='S'?'üî¥':'‚ö°'} [${token.grade}] ${token.symbol||'???'} ‚Äî ${token.score}/100`;
  c.appendChild(t);
  setTimeout(() => t.remove(), 4000);
}

// ‚ïê‚ïê CA ANALYZER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function analyzeCA() {
  const input = document.getElementById('ca-input');
  const result = document.getElementById('ca-result');
  const btn = document.getElementById('ca-btn');
  const ca = input.value.trim().replace(/\s+/g, '');

  if (!ca || ca.length < 32) {
    result.innerHTML = `<div class="ca-warn">‚ö† Invalid ‚Äî Solana CAs are 32-44 chars</div>`;
    return;
  }

  result.innerHTML = `<div style="text-align:center;padding:30px 10px;">
    <div style="width:36px;height:36px;border:1px solid var(--c);border-top-color:transparent;border-radius:50%;margin:0 auto 12px;animation:spin 0.8s linear infinite;"></div>
    <div style="font-family:var(--f1);font-size:9px;letter-spacing:2px;color:var(--c)">SCANNING</div>
    <div style="font-size:8px;color:var(--txt3);margin-top:4px">${ca.slice(0,8)}...${ca.slice(-6)}</div>
  </div>`;
  btn.disabled = true; btn.textContent = 'SCANNING...';

  try {
    const res = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${ca}`);
    const data = await res.json();
    const pairs = data.pairs || [];

    if (!pairs.length) {
      result.innerHTML = `<div class="ca-warn">‚ö† No pairs found<br><span style="font-size:8px;opacity:0.6">Not listed yet or wrong address</span></div>
      <div style="margin-top:8px;display:flex;gap:4px;flex-wrap:wrap">
        <a class="ca-link" href="https://solscan.io/token/${ca}" target="_blank">SOLSCAN</a>
        <a class="ca-link" href="https://pump.fun/${ca}" target="_blank">PUMP.FUN</a>
      </div>`;
      return;
    }

    const pair = pairs.find(p => p.dexId === 'pumpfun') ||
                 pairs.sort((a,b) => (b.liquidity?.usd||0)-(a.liquidity?.usd||0))[0];

    const t = {
      address: ca,
      symbol: pair.baseToken?.symbol || '???',
      name: pair.baseToken?.name || 'Unknown',
      priceUsd: parseFloat(pair.priceUsd||0),
      priceChange5m: pair.priceChange?.m5||0,
      priceChange1h: pair.priceChange?.h1||0,
      priceChange6h: pair.priceChange?.h6||0,
      volume5m: pair.volume?.m5||0,
      volume1h: pair.volume?.h1||0,
      volume24h: pair.volume?.h24||0,
      liquidityUsd: pair.liquidity?.usd||0,
      fdv: pair.fdv||0,
      marketCap: pair.marketCap||0,
      buys5m: pair.txns?.m5?.buys||0,
      sells5m: pair.txns?.m5?.sells||0,
      buys1h: pair.txns?.h1?.buys||0,
      sells1h: pair.txns?.h1?.sells||0,
      buyRatio5m: (() => { const tx=pair.txns?.m5; if(!tx) return 0.5; const tot=(tx.buys||0)+(tx.sells||0); return tot?tx.buys/tot:0.5; })(),
      pairCreatedAt: pair.pairCreatedAt,
      imageUrl: pair.info?.imageUrl,
      socials: pair.info?.socials||[],
      websites: pair.info?.websites||[],
      dexUrl: pair.url, dexId: pair.dexId,
      pairCount: pairs.length,
    };

    const sr = caScore(t);
    const gc = gcolor(sr.grade);
    const ageMin = t.pairCreatedAt ? Math.round((Date.now()-t.pairCreatedAt)/60000) : null;
    const ageStr = ageMin===null ? '?' : ageMin<60 ? ageMin+'m' : Math.floor(ageMin/60)+'h '+(ageMin%60)+'m';

    result.innerHTML = `
      ${t.imageUrl?`<img src="${t.imageUrl}" style="width:40px;height:40px;border-radius:50%;border:1px solid ${gc}30;margin-bottom:8px" onerror="this.style.display='none'">`:''}
      <div class="ca-result-hdr">
        <div class="ca-grade" style="background:${gc}15;color:${gc}">${sr.grade}</div>
        <div>
          <div class="ca-sym">${esc(t.symbol)}</div>
          <div class="ca-nm">${esc(t.name)}</div>
        </div>
        <div class="ca-score-big" style="color:${gc}">${sr.score}</div>
      </div>
      <div class="ca-bar-wrap">
        <div class="ca-bar-track"><div class="ca-bar-fill" style="width:${sr.score}%;background:${gc}"></div></div>
      </div>

      ${sr.warnings.length?`<div class="ca-warn" style="margin-top:6px">${sr.warnings.map(w=>`${w}`).join('<br>')}</div>`:''}

      <div style="margin-top:6px">
        <div class="ca-label">SIGNALS</div>
        <div class="ca-flags">${sr.flags.map(f=>`<span class="flag ${getFlagCls(f)}">${f.replace(/_/g,' ')}</span>`).join('') || '<span style="font-size:8px;color:var(--txt3)">none detected</span>'}</div>
      </div>

      <div class="divider"></div>

      <div class="ca-stat-grid">
        ${[['PRICE',fmtP(t.priceUsd)],['5M %',fmtC(t.priceChange5m)],['1H %',fmtC(t.priceChange1h)],['FDV',fmtL(t.fdv)],['LIQ',fmtL(t.liquidityUsd)],['VOL 5M',fmtL(t.volume5m)],['BUYS',t.buys5m],['SELLS',t.sells5m],['B%',((t.buyRatio5m)*100).toFixed(0)+'%'],['VOL 24H',fmtL(t.volume24h)],['AGE',ageStr],['PAIRS',t.pairCount]].map(([l,v])=>`<div class="ca-stat-cell"><div class="ca-stat-lbl">${l}</div><div class="ca-stat-val">${v}</div></div>`).join('')}
      </div>

      <div class="divider"></div>

      <div class="ca-label">OPEN IN</div>
      <div class="ca-links">
        <a class="ca-link" href="https://pump.fun/${ca}" target="_blank">PUMP</a>
        <a class="ca-link" href="${t.dexUrl||'https://dexscreener.com/solana/'+ca}" target="_blank">DEX</a>
        <a class="ca-link" href="https://solscan.io/token/${ca}" target="_blank">SCAN</a>
        <a class="ca-link" href="https://birdeye.so/token/${ca}?chain=solana" target="_blank">BIRD</a>
        <a class="ca-link" href="https://rugcheck.xyz/tokens/${ca}" target="_blank">RUG‚úì</a>
      </div>
    `;
  } catch(err) {
    result.innerHTML = `<div class="ca-warn">‚ö† Error: ${err.message}</div>`;
  } finally {
    btn.disabled = false; btn.textContent = '‚¨° ANALYZE TOKEN';
  }
}

function caScore(t) {
  let score = 0; const flags = []; const warnings = [];
  if (t.liquidityUsd < 3000) warnings.push('‚ö† LOW LIQUIDITY');
  if (t.buyRatio5m < 0.3) warnings.push('‚ö† HEAVY SELLING PRESSURE');
  if (t.buyRatio5m >= 0.75)        { score+=18; flags.push('STRONG_BUY_PRESSURE'); }
  else if (t.buyRatio5m >= 0.6)    { score+=10; flags.push('MODERATE_BUY_PRESSURE'); }
  if (t.priceChange5m >= 50)       { score+=12; flags.push('5M_EXPLOSION'); }
  else if (t.priceChange5m >= 20)  { score+=8;  flags.push('5M_SURGE'); }
  else if (t.priceChange5m >= 5)   { score+=4;  flags.push('5M_PUMP'); }
  if (t.buys5m >= 50)              { score+=10; flags.push('HIGH_ORGANIC_BUYS'); }
  else if (t.buys5m >= 20)         { score+=5;  flags.push('ORGANIC_BUYS'); }
  if (t.liquidityUsd >= 50000)     { score+=12; flags.push('STRONG_LIQUIDITY'); }
  else if (t.liquidityUsd >= 15000){ score+=6;  flags.push('DECENT_LIQUIDITY'); }
  else if (t.liquidityUsd >= 5000) { score+=2;  flags.push('FAIR_LIQUIDITY'); }
  const age = t.pairCreatedAt ? (Date.now()-t.pairCreatedAt)/60000 : 999;
  if (age<=5)       { score+=10; flags.push('ULTRA_EARLY'); }
  else if (age<=15) { score+=6;  flags.push('EARLY_ENTRY'); }
  else if (age<=60) { score+=2;  flags.push('RECENT'); }
  if (t.socials?.some(s=>s.type==='twitter'))  { score+=5; flags.push('HAS_TWITTER'); }
  if (t.socials?.some(s=>s.type==='telegram')) { score+=5; flags.push('HAS_TELEGRAM'); }
  if (t.websites?.length > 0)                  { score+=5; flags.push('HAS_WEBSITE'); }
  if (t.pairCount > 3) { score+=5; flags.push('MULTI_DEX'); }
  score = Math.min(score, 100);
  const grade = score>=80?'S':score>=60?'A':score>=40?'B':'C';
  return { score, grade, flags, warnings };
}

// ‚ïê‚ïê HELPERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function gcolor(g) { return {S:'var(--og)',A:'var(--ga)',B:'var(--gb)',C:'var(--txt3)'}[g]||'#888'; }
function chgCls(v) { return v>0?'pos':v<0?'neg':'neu'; }
function chgColor(v) { return v>0?'var(--gn)':v<0?'var(--rd)':'var(--txt3)'; }
function fmtC(v) { if(!v) return '0.0%'; return (v>0?'+':'')+Number(v).toFixed(1)+'%'; }
function fmtP(p) {
  if (!p) return '$0';
  if (p < 0.000001) return '$'+Number(p).toExponential(2);
  if (p < 0.001) return '$'+Number(p).toFixed(8);
  if (p < 1) return '$'+Number(p).toFixed(6);
  return '$'+Number(p).toFixed(4);
}
function fmtL(n) {
  if (!n) return '$0';
  if (n>=1e9) return '$'+(n/1e9).toFixed(1)+'B';
  if (n>=1e6) return '$'+(n/1e6).toFixed(1)+'M';
  if (n>=1e3) return '$'+(n/1e3).toFixed(1)+'K';
  return '$'+Math.round(n);
}
function timeAgo(ts) {
  if (!ts) return '?';
  const m = Math.floor((Date.now()-new Date(ts))/60000);
  if (m<1) return 'just now';
  if (m<60) return m+'m ago';
  return Math.floor(m/60)+'h ago';
}
function esc(s) { return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function getFlagCls(f) {
  if (f.includes('SMART')||f.includes('MULTI')) return 'flag-s';
  if (f.includes('BUY')||f.includes('EARLY')||f.includes('EXPLOSION')||f.includes('SURGE')) return 'flag-b';
  if (f.includes('LIQUID')||f.includes('TWITTER')||f.includes('TELEGRAM')||f.includes('WEBSITE')) return 'flag-c';
  return 'flag-d';
}
</script>
</body>
</html>
