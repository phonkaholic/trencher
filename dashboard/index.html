<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>trencher ‚Äî solana gem scanner</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Share+Tech+Mono&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  :root {
    --void: #000408;
    --deep: #010a14;
    --surface: #051525;
    --panel: rgba(5,21,37,0.85);
    --border: rgba(0,200,255,0.12);
    --border-hot: rgba(0,200,255,0.5);
    --cyan: #00c8ff;
    --cyan-dim: rgba(0,200,255,0.15);
    --cyan-glow: 0 0 20px rgba(0,200,255,0.4), 0 0 60px rgba(0,200,255,0.1);
    --orange: #ff6b00;
    --orange-dim: rgba(255,107,0,0.15);
    --orange-glow: 0 0 20px rgba(255,107,0,0.5), 0 0 60px rgba(255,107,0,0.15);
    --green: #00ff88;
    --green-dim: rgba(0,255,136,0.1);
    --red: #ff2244;
    --yellow: #ffcc00;
    --grade-s: #ff6b00;
    --grade-a: #ffcc00;
    --grade-b: #00c8ff;
    --grade-c: #334455;
    --font-display: 'Orbitron', monospace;
    --font-mono: 'Share Tech Mono', monospace;
    --font-body: 'Rajdhani', sans-serif;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  
  html { font-size: 14px; cursor: none; }
  
  body {
    background: var(--void);
    color: #c8e8f8;
    font-family: var(--font-mono);
    min-height: 100vh;
    overflow-x: hidden;
    position: relative;
  }

  /* ‚îÄ‚îÄ CUSTOM CURSOR ‚îÄ‚îÄ */
  #cursor {
    position: fixed;
    width: 20px; height: 20px;
    border: 1px solid var(--cyan);
    border-radius: 50%;
    pointer-events: none;
    z-index: 9999;
    transform: translate(-50%, -50%);
    transition: transform 0.1s, border-color 0.2s, width 0.2s, height 0.2s;
    mix-blend-mode: screen;
  }
  #cursor-dot {
    position: fixed;
    width: 4px; height: 4px;
    background: var(--cyan);
    border-radius: 50%;
    pointer-events: none;
    z-index: 9999;
    transform: translate(-50%, -50%);
    box-shadow: 0 0 6px var(--cyan);
  }
  body:hover #cursor { width: 24px; height: 24px; }

  /* ‚îÄ‚îÄ STAR CANVAS ‚îÄ‚îÄ */
  #starfield {
    position: fixed;
    inset: 0;
    z-index: 0;
    pointer-events: none;
  }

  /* ‚îÄ‚îÄ SCAN LINE OVERLAY ‚îÄ‚îÄ */
  body::after {
    content: '';
    position: fixed;
    inset: 0;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(0,200,255,0.015) 2px,
      rgba(0,200,255,0.015) 4px
    );
    pointer-events: none;
    z-index: 1;
    animation: scanMove 8s linear infinite;
  }
  @keyframes scanMove {
    from { background-position: 0 0; }
    to   { background-position: 0 100px; }
  }

  /* ‚îÄ‚îÄ VIGNETTE ‚îÄ‚îÄ */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: radial-gradient(ellipse at center, transparent 40%, rgba(0,0,0,0.8) 100%);
    pointer-events: none;
    z-index: 1;
  }

  /* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
  #app {
    position: relative;
    z-index: 2;
    min-height: 100vh;
    display: grid;
    grid-template-rows: auto auto 1fr auto;
    grid-template-columns: 1fr;
  }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  header {
    padding: 0 32px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid var(--border);
    background: linear-gradient(180deg, rgba(0,200,255,0.03) 0%, transparent 100%);
    backdrop-filter: blur(12px);
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .logo-mark {
    width: 36px; height: 36px;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .logo-mark::before {
    content: '';
    position: absolute;
    inset: 0;
    border: 1px solid var(--cyan);
    transform: rotate(45deg);
    animation: logoSpin 8s linear infinite;
  }
  .logo-mark::after {
    content: '';
    position: absolute;
    inset: 6px;
    border: 1px solid var(--orange);
    transform: rotate(45deg);
    animation: logoSpin 8s linear infinite reverse;
  }
  .logo-mark span {
    font-size: 12px;
    color: var(--cyan);
    position: relative;
    z-index: 1;
  }
  @keyframes logoSpin {
    from { transform: rotate(45deg); }
    to   { transform: rotate(405deg); }
  }

  .logo-text {
    font-family: var(--font-display);
    font-size: 22px;
    font-weight: 900;
    letter-spacing: 4px;
    color: #fff;
    text-shadow: var(--cyan-glow);
  }
  .logo-sub {
    font-size: 10px;
    color: rgba(0,200,255,0.5);
    letter-spacing: 3px;
    margin-top: 2px;
    font-family: var(--font-mono);
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: 24px;
  }

  .live-indicator {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 11px;
    letter-spacing: 2px;
    color: var(--green);
  }
  .live-dot {
    width: 8px; height: 8px;
    background: var(--green);
    border-radius: 50%;
    box-shadow: 0 0 8px var(--green), 0 0 16px rgba(0,255,136,0.4);
    animation: livePulse 2s ease-in-out infinite;
  }
  @keyframes livePulse {
    0%, 100% { opacity: 1; transform: scale(1); box-shadow: 0 0 8px var(--green), 0 0 16px rgba(0,255,136,0.4); }
    50%       { opacity: 0.6; transform: scale(0.8); box-shadow: 0 0 4px var(--green); }
  }

  .header-time {
    font-family: var(--font-display);
    font-size: 13px;
    color: rgba(200,232,248,0.4);
    letter-spacing: 2px;
  }

  .tg-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    border: 1px solid var(--border);
    background: var(--cyan-dim);
    color: var(--cyan);
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: 2px;
    cursor: none;
    text-decoration: none;
    transition: all 0.2s;
    clip-path: polygon(8px 0, 100% 0, calc(100% - 8px) 100%, 0 100%);
  }
  .tg-btn:hover {
    background: var(--cyan-dim);
    border-color: var(--cyan);
    box-shadow: var(--cyan-glow);
    color: #fff;
  }

  /* ‚îÄ‚îÄ STATS BAR ‚îÄ‚îÄ */
  .stats-bar {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    border-bottom: 1px solid var(--border);
    background: rgba(0,0,0,0.4);
    backdrop-filter: blur(8px);
  }

  .stat-cell {
    padding: 14px 20px;
    border-right: 1px solid var(--border);
    text-align: center;
    position: relative;
    overflow: hidden;
    transition: background 0.3s;
  }
  .stat-cell:last-child { border-right: none; }
  .stat-cell::before {
    content: '';
    position: absolute;
    bottom: 0; left: 0; right: 0;
    height: 1px;
    background: var(--cyan);
    transform: scaleX(0);
    transition: transform 0.4s ease;
    transform-origin: center;
  }
  .stat-cell:hover::before { transform: scaleX(1); }

  .stat-value {
    font-family: var(--font-display);
    font-size: 24px;
    font-weight: 700;
    line-height: 1;
    transition: all 0.3s;
  }
  .stat-label {
    font-size: 9px;
    letter-spacing: 2px;
    color: rgba(200,232,248,0.35);
    margin-top: 5px;
    font-family: var(--font-mono);
  }

  /* ‚îÄ‚îÄ MAIN GRID ‚îÄ‚îÄ */
  .main-grid {
    display: grid;
    grid-template-columns: 1fr 340px;
    gap: 0;
    min-height: 0;
  }

  /* ‚îÄ‚îÄ TOKEN FEED ‚îÄ‚îÄ */
  .feed-panel {
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .panel-header {
    padding: 14px 24px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(0,0,0,0.3);
  }

  .panel-title {
    font-family: var(--font-display);
    font-size: 11px;
    letter-spacing: 3px;
    color: var(--cyan);
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .panel-title::before {
    content: '';
    display: block;
    width: 6px; height: 6px;
    background: var(--cyan);
    transform: rotate(45deg);
    box-shadow: 0 0 8px var(--cyan);
  }

  .filter-pills {
    display: flex;
    gap: 4px;
  }
  .pill {
    padding: 4px 12px;
    font-size: 11px;
    font-family: var(--font-display);
    font-weight: 700;
    letter-spacing: 1px;
    border: 1px solid transparent;
    background: transparent;
    cursor: none;
    transition: all 0.15s;
    clip-path: polygon(4px 0, 100% 0, calc(100% - 4px) 100%, 0 100%);
  }
  .pill.active-s { background: rgba(255,107,0,0.2); border-color: var(--orange); color: var(--orange); box-shadow: 0 0 10px rgba(255,107,0,0.3); }
  .pill.active-a { background: rgba(255,204,0,0.2); border-color: var(--yellow); color: var(--yellow); }
  .pill.active-b { background: rgba(0,200,255,0.15); border-color: var(--cyan); color: var(--cyan); }
  .pill.active-all { background: rgba(200,232,248,0.1); border-color: rgba(200,232,248,0.3); color: #c8e8f8; }
  .pill.inactive { color: rgba(200,232,248,0.3); border-color: rgba(200,232,248,0.08); }
  .pill.inactive:hover { color: rgba(200,232,248,0.6); border-color: rgba(200,232,248,0.2); }

  /* ‚îÄ‚îÄ TABLE HEADER ‚îÄ‚îÄ */
  .table-head {
    display: grid;
    grid-template-columns: 48px 1fr 70px 95px 85px 90px 85px 75px;
    padding: 10px 24px;
    border-bottom: 1px solid var(--border);
    font-size: 9px;
    letter-spacing: 2px;
    color: rgba(200,232,248,0.3);
    background: rgba(0,0,0,0.5);
    font-family: var(--font-mono);
    position: sticky;
    top: 64px;
    z-index: 50;
  }
  .th { display: flex; align-items: center; }
  .th.right { justify-content: flex-end; }

  /* ‚îÄ‚îÄ TOKEN ROWS ‚îÄ‚îÄ */
  .token-list {
    overflow-y: auto;
    flex: 1;
  }
  .token-list::-webkit-scrollbar { width: 3px; }
  .token-list::-webkit-scrollbar-track { background: transparent; }
  .token-list::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  .token-row {
    display: grid;
    grid-template-columns: 48px 1fr 70px 95px 85px 90px 85px 75px;
    padding: 11px 24px;
    border-bottom: 1px solid rgba(0,200,255,0.05);
    cursor: none;
    transition: background 0.15s;
    position: relative;
    overflow: hidden;
    animation: rowIn 0.4s ease both;
  }
  @keyframes rowIn {
    from { opacity: 0; transform: translateX(-10px); }
    to   { opacity: 1; transform: translateX(0); }
  }
  .token-row::before {
    content: '';
    position: absolute;
    left: 0; top: 0; bottom: 0;
    width: 2px;
    opacity: 0;
    transition: opacity 0.2s;
  }
  .token-row.grade-S::before { background: var(--orange); box-shadow: var(--orange-glow); }
  .token-row.grade-A::before { background: var(--yellow); }
  .token-row.grade-B::before { background: var(--cyan); }
  .token-row.grade-C::before { background: #334; }

  .token-row:hover { background: rgba(0,200,255,0.04); }
  .token-row:hover::before { opacity: 1; }

  .token-row.new-entry {
    animation: newEntry 0.5s ease both;
  }
  @keyframes newEntry {
    from { background: rgba(255,107,0,0.1); transform: translateX(-8px); }
    to   { background: transparent; transform: translateX(0); }
  }

  /* Grade badge */
  .grade-badge {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px; height: 32px;
    font-family: var(--font-display);
    font-weight: 900;
    font-size: 14px;
    clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
  }
  .grade-S .grade-badge { background: rgba(255,107,0,0.2); color: var(--orange); box-shadow: 0 0 12px rgba(255,107,0,0.3); animation: gradeGlow 2s ease-in-out infinite; }
  .grade-A .grade-badge { background: rgba(255,204,0,0.15); color: var(--yellow); }
  .grade-B .grade-badge { background: rgba(0,200,255,0.1); color: var(--cyan); }
  .grade-C .grade-badge { background: rgba(51,68,85,0.3); color: #334455; }
  @keyframes gradeGlow {
    0%, 100% { box-shadow: 0 0 12px rgba(255,107,0,0.3); }
    50%       { box-shadow: 0 0 24px rgba(255,107,0,0.6), 0 0 48px rgba(255,107,0,0.2); }
  }

  .token-info { display: flex; flex-direction: column; justify-content: center; gap: 4px; overflow: hidden; }
  .token-name { display: flex; align-items: center; gap: 8px; }
  .token-symbol { font-family: var(--font-display); font-size: 13px; font-weight: 700; color: #fff; white-space: nowrap; }
  .token-fullname { font-size: 11px; color: rgba(200,232,248,0.4); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 120px; }
  .token-flags { display: flex; gap: 4px; flex-wrap: wrap; }
  .flag { font-size: 9px; padding: 1px 6px; border-radius: 2px; letter-spacing: 0.5px; border: 1px solid; }
  .flag-smart { border-color: rgba(167,139,250,0.4); color: #a78bfa; background: rgba(167,139,250,0.08); }
  .flag-buy   { border-color: rgba(0,255,136,0.3); color: var(--green); background: rgba(0,255,136,0.06); }
  .flag-surge { border-color: rgba(255,107,0,0.3); color: var(--orange); background: rgba(255,107,0,0.06); }
  .flag-safe  { border-color: rgba(0,200,255,0.3); color: var(--cyan); background: rgba(0,200,255,0.06); }
  .flag-default { border-color: rgba(200,232,248,0.1); color: rgba(200,232,248,0.4); background: transparent; }

  .td { display: flex; align-items: center; font-size: 12px; }
  .td.right { justify-content: flex-end; }
  .td.center { justify-content: center; }

  .score-bar {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 3px;
    width: 100%;
  }
  .score-num { font-family: var(--font-display); font-size: 13px; font-weight: 700; }
  .score-track { width: 36px; height: 2px; background: rgba(200,232,248,0.1); border-radius: 1px; }
  .score-fill { height: 100%; border-radius: 1px; transition: width 0.5s ease; }

  .price { font-family: var(--font-mono); font-size: 11px; }
  .change { font-family: var(--font-display); font-size: 12px; font-weight: 700; }
  .change.pos { color: var(--green); }
  .change.neg { color: var(--red); }
  .change.neu { color: rgba(200,232,248,0.3); }

  .val { font-family: var(--font-mono); font-size: 11px; color: rgba(200,232,248,0.6); }

  .buys-sells { display: flex; align-items: center; gap: 4px; font-size: 11px; }
  .buys-num { color: var(--green); font-family: var(--font-display); font-size: 12px; font-weight: 600; }
  .sells-num { color: var(--red); font-family: var(--font-display); font-size: 12px; font-weight: 600; }

  .age { font-family: var(--font-mono); font-size: 11px; color: rgba(200,232,248,0.4); }
  .age.fresh { color: var(--orange); animation: agePulse 1s ease-in-out infinite; }
  @keyframes agePulse { 0%,100%{opacity:1} 50%{opacity:0.5} }

  /* ‚îÄ‚îÄ RIGHT PANEL ‚Äî ALERT HISTORY ‚îÄ‚îÄ */
  .alert-panel {
    display: flex;
    flex-direction: column;
    overflow: hidden;
    background: rgba(0,0,0,0.2);
  }

  .alert-list {
    overflow-y: auto;
    flex: 1;
  }
  .alert-list::-webkit-scrollbar { width: 2px; }
  .alert-list::-webkit-scrollbar-thumb { background: var(--border); }

  .alert-card {
    padding: 14px 18px;
    border-bottom: 1px solid rgba(0,200,255,0.06);
    cursor: none;
    transition: background 0.15s;
    position: relative;
    animation: alertIn 0.4s ease both;
  }
  @keyframes alertIn {
    from { opacity: 0; transform: translateX(10px); }
    to   { opacity: 1; transform: translateX(0); }
  }
  .alert-card:hover { background: rgba(0,200,255,0.03); }
  .alert-card.grade-S { border-left: 2px solid var(--orange); }
  .alert-card.grade-A { border-left: 2px solid var(--yellow); }

  .alert-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
  .alert-symbol { font-family: var(--font-display); font-size: 14px; font-weight: 700; color: #fff; }
  .alert-grade {
    font-family: var(--font-display);
    font-size: 11px;
    font-weight: 900;
    padding: 2px 8px;
    clip-path: polygon(4px 0, 100% 0, calc(100% - 4px) 100%, 0 100%);
  }
  .alert-grade.S { background: rgba(255,107,0,0.2); color: var(--orange); box-shadow: 0 0 8px rgba(255,107,0,0.3); }
  .alert-grade.A { background: rgba(255,204,0,0.15); color: var(--yellow); }

  .alert-meta { display: flex; justify-content: space-between; font-size: 10px; color: rgba(200,232,248,0.4); margin-bottom: 8px; }
  .alert-flags { display: flex; flex-wrap: wrap; gap: 3px; }

  .alert-score-row { display: flex; align-items: center; gap: 8px; margin-top: 8px; }
  .alert-score-track { flex: 1; height: 2px; background: rgba(200,232,248,0.08); border-radius: 1px; }
  .alert-score-fill { height: 100%; border-radius: 1px; }
  .alert-score-num { font-family: var(--font-display); font-size: 11px; font-weight: 700; min-width: 24px; text-align: right; }

  .alert-links { display: flex; gap: 8px; margin-top: 8px; }
  .alert-link {
    font-size: 9px;
    letter-spacing: 1px;
    color: rgba(0,200,255,0.5);
    text-decoration: none;
    border: 1px solid rgba(0,200,255,0.15);
    padding: 2px 7px;
    transition: all 0.15s;
  }
  .alert-link:hover { color: var(--cyan); border-color: var(--cyan); box-shadow: 0 0 6px rgba(0,200,255,0.2); }

  /* ‚îÄ‚îÄ EMPTY STATES ‚îÄ‚îÄ */
  .empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 20px;
    color: rgba(200,232,248,0.2);
    gap: 12px;
    text-align: center;
  }
  .empty-icon { font-size: 32px; opacity: 0.3; animation: emptyPulse 3s ease-in-out infinite; }
  @keyframes emptyPulse { 0%,100%{opacity:0.3} 50%{opacity:0.6} }
  .empty-text { font-family: var(--font-display); font-size: 11px; letter-spacing: 2px; }
  .empty-sub { font-size: 11px; color: rgba(200,232,248,0.15); }

  /* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
  #modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,4,8,0.9);
    backdrop-filter: blur(8px);
    z-index: 500;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }
  #modal-overlay.open { display: flex; }

  #modal {
    background: var(--surface);
    border: 1px solid var(--border-hot);
    width: 100%;
    max-width: 580px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: var(--cyan-glow);
    clip-path: polygon(16px 0, 100% 0, 100% calc(100% - 16px), calc(100% - 16px) 100%, 0 100%, 0 16px);
    animation: modalIn 0.3s ease;
    position: relative;
  }
  #modal::-webkit-scrollbar { width: 2px; }
  #modal::-webkit-scrollbar-thumb { background: var(--border); }
  @keyframes modalIn {
    from { opacity: 0; transform: scale(0.95) translateY(10px); }
    to   { opacity: 1; transform: scale(1) translateY(0); }
  }

  .modal-close {
    position: absolute;
    top: 14px; right: 16px;
    background: none;
    border: none;
    color: rgba(200,232,248,0.4);
    font-size: 16px;
    cursor: none;
    transition: color 0.15s;
    font-family: var(--font-mono);
  }
  .modal-close:hover { color: var(--red); }

  .modal-header {
    padding: 24px 28px 20px;
    border-bottom: 1px solid var(--border);
    background: linear-gradient(135deg, rgba(0,200,255,0.03), transparent);
  }
  .modal-token-row { display: flex; align-items: center; gap: 16px; margin-bottom: 8px; }
  .modal-grade {
    font-family: var(--font-display);
    font-size: 28px;
    font-weight: 900;
    width: 56px; height: 56px;
    display: flex; align-items: center; justify-content: center;
    clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
  }
  .modal-grade.S { background: rgba(255,107,0,0.2); color: var(--orange); box-shadow: 0 0 20px rgba(255,107,0,0.4); }
  .modal-grade.A { background: rgba(255,204,0,0.15); color: var(--yellow); }
  .modal-grade.B { background: rgba(0,200,255,0.1); color: var(--cyan); }
  .modal-grade.C { background: rgba(51,68,85,0.2); color: #445; }
  .modal-symbol { font-family: var(--font-display); font-size: 26px; font-weight: 900; color: #fff; }
  .modal-name { font-size: 13px; color: rgba(200,232,248,0.5); margin-top: 2px; }
  .modal-address { font-size: 10px; color: rgba(200,232,248,0.3); font-family: var(--font-mono); margin-top: 4px; }

  .modal-score-section { padding: 16px 28px; border-bottom: 1px solid var(--border); }
  .modal-score-header { display: flex; justify-content: space-between; margin-bottom: 8px; }
  .modal-score-label { font-size: 10px; letter-spacing: 2px; color: rgba(200,232,248,0.4); }
  .modal-score-value { font-family: var(--font-display); font-size: 20px; font-weight: 700; }
  .modal-score-track { height: 6px; background: rgba(200,232,248,0.08); border-radius: 3px; overflow: hidden; }
  .modal-score-fill { height: 100%; border-radius: 3px; transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1); }

  .modal-flags { padding: 16px 28px; border-bottom: 1px solid var(--border); display: flex; flex-wrap: wrap; gap: 6px; }

  .modal-stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1px; background: var(--border); }
  .modal-stat {
    background: var(--surface);
    padding: 14px 16px;
  }
  .modal-stat-label { font-size: 9px; letter-spacing: 2px; color: rgba(200,232,248,0.3); margin-bottom: 6px; }
  .modal-stat-value { font-family: var(--font-display); font-size: 16px; font-weight: 700; }

  .modal-links { padding: 16px 28px; display: flex; gap: 10px; flex-wrap: wrap; }
  .modal-link {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    border: 1px solid var(--border);
    color: rgba(200,232,248,0.5);
    font-size: 11px;
    letter-spacing: 1px;
    text-decoration: none;
    transition: all 0.2s;
    font-family: var(--font-mono);
    clip-path: polygon(6px 0, 100% 0, calc(100% - 6px) 100%, 0 100%);
  }
  .modal-link:hover { border-color: var(--cyan); color: var(--cyan); background: var(--cyan-dim); box-shadow: var(--cyan-glow); }

  /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
  footer {
    padding: 12px 32px;
    border-top: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(0,0,0,0.5);
    font-size: 10px;
    color: rgba(200,232,248,0.2);
    font-family: var(--font-mono);
    letter-spacing: 1px;
  }
  footer a { color: var(--cyan); text-decoration: none; opacity: 0.6; transition: opacity 0.2s; }
  footer a:hover { opacity: 1; }

  /* ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ */
  .loading-row {
    padding: 12px 24px;
    display: flex;
    align-items: center;
    gap: 12px;
    border-bottom: 1px solid rgba(0,200,255,0.04);
    opacity: 0.4;
  }
  .skeleton {
    border-radius: 2px;
    background: linear-gradient(90deg, rgba(200,232,248,0.05) 25%, rgba(200,232,248,0.1) 50%, rgba(200,232,248,0.05) 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
  }
  @keyframes shimmer { 0%{background-position:200% 0} 100%{background-position:-200% 0} }

  /* ‚îÄ‚îÄ NOTIFICATION TOAST ‚îÄ‚îÄ */
  #toast-container {
    position: fixed;
    top: 80px;
    right: 24px;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 8px;
    pointer-events: none;
  }
  .toast {
    padding: 12px 18px;
    background: var(--surface);
    border: 1px solid;
    font-size: 12px;
    font-family: var(--font-mono);
    animation: toastIn 0.3s ease, toastOut 0.3s ease 3.7s forwards;
    clip-path: polygon(8px 0, 100% 0, calc(100% - 8px) 100%, 0 100%);
    letter-spacing: 1px;
    max-width: 320px;
  }
  .toast.grade-S { border-color: var(--orange); color: var(--orange); background: rgba(255,107,0,0.1); box-shadow: var(--orange-glow); }
  .toast.grade-A { border-color: var(--yellow); color: var(--yellow); background: rgba(255,204,0,0.08); }
  @keyframes toastIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
  @keyframes toastOut { from { opacity: 1; } to { opacity: 0; transform: translateX(20px); } }

  /* ‚îÄ‚îÄ RADAR ANIMATION (empty state) ‚îÄ‚îÄ */
  .radar {
    width: 80px; height: 80px;
    position: relative;
    margin: 0 auto;
  }
  .radar-ring {
    position: absolute;
    border: 1px solid var(--cyan);
    border-radius: 50%;
    opacity: 0;
    animation: radarExpand 2s ease-out infinite;
  }
  .radar-ring:nth-child(1) { inset: 0; animation-delay: 0s; }
  .radar-ring:nth-child(2) { inset: 15px; animation-delay: 0.5s; }
  .radar-ring:nth-child(3) { inset: 30px; animation-delay: 1s; }
  @keyframes radarExpand {
    0%   { opacity: 0.8; transform: scale(0.5); }
    100% { opacity: 0; transform: scale(1.5); }
  }
</style>
</head>
<body>

<canvas id="starfield"></canvas>
<div id="cursor"></div>
<div id="cursor-dot"></div>
<div id="toast-container"></div>

<div id="app">

  <!-- HEADER -->
  <header>
    <div class="logo">
      <div class="logo-mark"><span>‚¨°</span></div>
      <div>
        <div class="logo-text">TRENCHER</div>
        <div class="logo-sub">SOLANA GEM SCANNER</div>
      </div>
    </div>
    <div class="header-right">
      <div class="live-indicator">
        <div class="live-dot"></div>
        <span>LIVE</span>
      </div>
      <div class="header-time" id="clock">--:--:--</div>
      <a href="https://t.me/trencheralerts" target="_blank" class="tg-btn">
        ‚úà TELEGRAM
      </a>
    </div>
  </header>

  <!-- STATS BAR -->
  <div class="stats-bar">
    <div class="stat-cell">
      <div class="stat-value" id="stat-total" style="color:var(--cyan)">0</div>
      <div class="stat-label">SCANNED</div>
    </div>
    <div class="stat-cell">
      <div class="stat-value" id="stat-s" style="color:var(--orange)">0</div>
      <div class="stat-label">GRADE S üî¥</div>
    </div>
    <div class="stat-cell">
      <div class="stat-value" id="stat-a" style="color:var(--yellow)">0</div>
      <div class="stat-label">GRADE A ‚ö°</div>
    </div>
    <div class="stat-cell">
      <div class="stat-value" id="stat-b" style="color:var(--cyan)">0</div>
      <div class="stat-label">GRADE B üëÄ</div>
    </div>
    <div class="stat-cell">
      <div class="stat-value" id="stat-avg" style="color:var(--green)">0</div>
      <div class="stat-label">AVG SCORE</div>
    </div>
    <div class="stat-cell">
      <div class="stat-value" id="stat-alerts" style="color:#a78bfa">0</div>
      <div class="stat-label">ALERTS FIRED</div>
    </div>
    <div class="stat-cell">
      <div class="stat-value" id="stat-uptime" style="color:var(--green)">LIVE</div>
      <div class="stat-label">STATUS</div>
    </div>
  </div>

  <!-- MAIN GRID -->
  <div class="main-grid">

    <!-- LEFT: TOKEN FEED -->
    <div class="feed-panel">
      <div class="panel-header">
        <div class="panel-title">LIVE TOKEN FEED</div>
        <div class="filter-pills">
          <button class="pill active-all" onclick="setFilter('ALL')">ALL</button>
          <button class="pill inactive" onclick="setFilter('S')">S</button>
          <button class="pill inactive" onclick="setFilter('A')">A</button>
          <button class="pill inactive" onclick="setFilter('B')">B</button>
        </div>
      </div>
      <div class="table-head">
        <div class="th">GRD</div>
        <div class="th">TOKEN</div>
        <div class="th right">SCR</div>
        <div class="th right">PRICE</div>
        <div class="th right">5M%</div>
        <div class="th right">FDV</div>
        <div class="th right">BUYS/SELLS</div>
        <div class="th right">AGE</div>
      </div>
      <div class="token-list" id="token-list">
        <div class="empty-state">
          <div class="radar">
            <div class="radar-ring"></div>
            <div class="radar-ring"></div>
            <div class="radar-ring"></div>
          </div>
          <div class="empty-text">INITIALIZING SCANNER</div>
          <div class="empty-sub">connecting to supabase realtime...</div>
        </div>
      </div>
    </div>

    <!-- RIGHT: ALERT HISTORY -->
    <div class="alert-panel">
      <div class="panel-header">
        <div class="panel-title">ALERT HISTORY</div>
        <div style="font-size:10px;color:rgba(200,232,248,0.3);font-family:var(--font-mono)">GRADE S + A</div>
      </div>
      <div class="alert-list" id="alert-list">
        <div class="empty-state">
          <div class="empty-icon">üì°</div>
          <div class="empty-text">SCANNING...</div>
          <div class="empty-sub">alerts will appear here</div>
        </div>
      </div>
    </div>

  </div>

  <!-- FOOTER -->
  <footer>
    <span>trencher v1.0 ‚Äî <a href="https://github.com/phonkaholic/trencher">open source</a></span>
    <span id="footer-count">0 tokens tracked</span>
    <span>‚ö† not financial advice ‚Äî DYOR</span>
  </footer>

</div>

<!-- TOKEN MODAL -->
<div id="modal-overlay" onclick="closeModal(event)">
  <div id="modal">
    <button class="modal-close" onclick="closeModal()">‚úï CLOSE</button>
    <div id="modal-content"></div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STARFIELD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const canvas = document.getElementById('starfield');
const ctx = canvas.getContext('2d');
let stars = [];

function initStars() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  stars = Array.from({ length: 200 }, () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    r: Math.random() * 1.2,
    speed: Math.random() * 0.3 + 0.05,
    opacity: Math.random() * 0.6 + 0.1,
    twinkle: Math.random() * Math.PI * 2,
  }));
}

function drawStars(t) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  stars.forEach(s => {
    s.twinkle += 0.02;
    const op = s.opacity * (0.7 + 0.3 * Math.sin(s.twinkle));
    ctx.beginPath();
    ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(200,232,248,${op})`;
    ctx.fill();
    s.y -= s.speed;
    if (s.y < -2) { s.y = canvas.height + 2; s.x = Math.random() * canvas.width; }
  });
  // Occasional shooting star
  if (Math.random() < 0.002) drawShootingStar();
  requestAnimationFrame(drawStars);
}

function drawShootingStar() {
  const x = Math.random() * canvas.width;
  const y = Math.random() * canvas.height * 0.5;
  const len = 80 + Math.random() * 120;
  const grad = ctx.createLinearGradient(x, y, x + len, y + len * 0.3);
  grad.addColorStop(0, 'rgba(0,200,255,0)');
  grad.addColorStop(0.5, 'rgba(0,200,255,0.8)');
  grad.addColorStop(1, 'rgba(0,200,255,0)');
  ctx.beginPath();
  ctx.moveTo(x, y);
  ctx.lineTo(x + len, y + len * 0.3);
  ctx.strokeStyle = grad;
  ctx.lineWidth = 1.5;
  ctx.stroke();
}

window.addEventListener('resize', initStars);
initStars();
requestAnimationFrame(drawStars);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CUSTOM CURSOR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const cursor = document.getElementById('cursor');
const cursorDot = document.getElementById('cursor-dot');
let cx = 0, cy = 0, tx = 0, ty = 0;

document.addEventListener('mousemove', e => { tx = e.clientX; ty = e.clientY; });

function animateCursor() {
  cx += (tx - cx) * 0.15;
  cy += (ty - cy) * 0.15;
  cursor.style.left = cx + 'px';
  cursor.style.top = cy + 'px';
  cursorDot.style.left = tx + 'px';
  cursorDot.style.top = ty + 'px';
  requestAnimationFrame(animateCursor);
}
animateCursor();

document.querySelectorAll('a, button, .token-row, .alert-card').forEach(el => {
  el.addEventListener('mouseenter', () => {
    cursor.style.width = '36px';
    cursor.style.height = '36px';
    cursor.style.borderColor = 'var(--orange)';
  });
  el.addEventListener('mouseleave', () => {
    cursor.style.width = '20px';
    cursor.style.height = '20px';
    cursor.style.borderColor = 'var(--cyan)';
  });
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CLOCK
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateClock() {
  const now = new Date();
  document.getElementById('clock').textContent =
    now.toUTCString().slice(17, 25) + ' UTC';
}
setInterval(updateClock, 1000);
updateClock();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA LAYER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SUPABASE_URL = 'https://wwlomifjbgblcvjhggdb.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind3bG9taWZqYmdibGN2amhnZ2RiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExODQ0MzQsImV4cCI6MjA4Njc2MDQzNH0.2_w4SV9tJcF5XcSSunrqKiI0SgPcgjuKbtSvjPsR_Mg';
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let allTokens = [];
let allAlerts = [];
let currentFilter = 'ALL';

// ‚îÄ‚îÄ FETCH INITIAL DATA ‚îÄ‚îÄ
async function loadInitial() {
  const [{ data: tokens }, { data: alerts }] = await Promise.all([
    sb.from('tokens').select('*').order('scored_at', { ascending: false }).limit(200),
    sb.from('alerts').select('*').order('alerted_at', { ascending: false }).limit(50)
  ]);

  if (tokens) { allTokens = tokens; renderTokens(); updateStats(); }
  if (alerts) { allAlerts = alerts; renderAlerts(); }
}

// ‚îÄ‚îÄ REALTIME SUBSCRIPTIONS ‚îÄ‚îÄ
sb.channel('trencher-live')
  .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'tokens' }, ({ new: token }) => {
    allTokens.unshift(token);
    if (allTokens.length > 200) allTokens.pop();
    renderTokens();
    updateStats();
    showToast(token);
  })
  .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'tokens' }, ({ new: token }) => {
    const idx = allTokens.findIndex(t => t.address === token.address);
    if (idx >= 0) allTokens[idx] = token;
    else allTokens.unshift(token);
    renderTokens();
    updateStats();
  })
  .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'alerts' }, ({ new: alert }) => {
    allAlerts.unshift(alert);
    renderAlerts();
  })
  .subscribe();

loadInitial();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER TOKENS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setFilter(f) {
  currentFilter = f;
  document.querySelectorAll('.pill').forEach(p => {
    p.className = 'pill inactive';
  });
  const map = { ALL: 'active-all', S: 'active-s', A: 'active-a', B: 'active-b' };
  event.target.className = `pill ${map[f]}`;
  renderTokens();
}

function renderTokens() {
  const list = document.getElementById('token-list');
  const filtered = currentFilter === 'ALL'
    ? allTokens
    : allTokens.filter(t => t.grade === currentFilter);

  if (!filtered.length) {
    list.innerHTML = `<div class="empty-state">
      <div class="radar"><div class="radar-ring"></div><div class="radar-ring"></div><div class="radar-ring"></div></div>
      <div class="empty-text">SCANNING TRENCHES</div>
      <div class="empty-sub">awaiting grade ${currentFilter} signals...</div>
    </div>`;
    return;
  }

  list.innerHTML = filtered.map((t, i) => `
    <div class="token-row grade-${t.grade} ${i === 0 ? 'new-entry' : ''}"
         onclick="openModal('${t.address}')"
         style="animation-delay:${Math.min(i * 0.02, 0.5)}s">
      <div class="td center">
        <div class="grade-badge">${t.grade}</div>
      </div>
      <div class="token-info">
        <div class="token-name">
          ${t.image_url ? `<img src="${t.image_url}" style="width:16px;height:16px;border-radius:50%;object-fit:cover" onerror="this.style.display='none'">` : ''}
          <span class="token-symbol">${esc(t.symbol || '???')}</span>
          <span class="token-fullname">${esc((t.name || '').slice(0, 18))}</span>
        </div>
        <div class="token-flags">${renderFlags(t.flags)}</div>
      </div>
      <div class="td right">
        <div class="score-bar">
          <div class="score-num" style="color:${gradeColor(t.grade)}">${t.score}</div>
          <div class="score-track"><div class="score-fill" style="width:${t.score}%;background:${gradeColor(t.grade)}"></div></div>
        </div>
      </div>
      <div class="td right"><span class="price">${fmtPrice(t.price_usd)}</span></div>
      <div class="td right"><span class="change ${chgClass(t.price_change_5m)}">${fmtChg(t.price_change_5m)}</span></div>
      <div class="td right"><span class="val">${fmtLarge(t.fdv)}</span></div>
      <div class="td right">
        <div class="buys-sells">
          <span class="buys-num">${t.buys_5m || 0}</span>
          <span style="color:rgba(200,232,248,0.2);font-size:10px">/</span>
          <span class="sells-num">${t.sells_5m || 0}</span>
        </div>
      </div>
      <div class="td right"><span class="age ${isUltraFresh(t.pair_created_at) ? 'fresh' : ''}">${fmtAge(t.pair_created_at)}</span></div>
    </div>
  `).join('');

  document.getElementById('footer-count').textContent = `${filtered.length} tokens tracked`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER ALERTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderAlerts() {
  const list = document.getElementById('alert-list');
  const gradeFiltered = allAlerts.filter(a => a.grade === 'S' || a.grade === 'A');

  if (!gradeFiltered.length) {
    list.innerHTML = `<div class="empty-state">
      <div class="empty-icon">üì°</div>
      <div class="empty-text">SCANNING...</div>
      <div class="empty-sub">grade S and A alerts appear here</div>
    </div>`;
    return;
  }

  list.innerHTML = gradeFiltered.map((a, i) => `
    <div class="alert-card grade-${a.grade}" style="animation-delay:${Math.min(i*0.03,0.5)}s">
      <div class="alert-top">
        <span class="alert-symbol">${esc(a.token_symbol || '???')}</span>
        <span class="alert-grade ${a.grade}">${a.grade}</span>
      </div>
      <div class="alert-meta">
        <span>${fmtTimeAgo(a.alerted_at)}</span>
        <span style="color:${gradeColor(a.grade)}">${a.score}/100</span>
      </div>
      <div class="alert-flags">${renderFlags(a.flags, true)}</div>
      <div class="alert-score-row">
        <div class="alert-score-track">
          <div class="alert-score-fill" style="width:${a.score}%;background:${gradeColor(a.grade)}"></div>
        </div>
      </div>
      <div class="alert-links">
        <a class="alert-link" href="https://pump.fun/${a.token_address}" target="_blank">PUMP</a>
        <a class="alert-link" href="https://dexscreener.com/solana/${a.token_address}" target="_blank">CHART</a>
        <a class="alert-link" href="https://solscan.io/token/${a.token_address}" target="_blank">SCAN</a>
      </div>
    </div>
  `).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateStats() {
  const t = allTokens;
  const avg = t.length ? Math.round(t.reduce((s,x) => s+(x.score||0),0)/t.length) : 0;
  animateNum('stat-total', t.length);
  animateNum('stat-s', t.filter(x=>x.grade==='S').length);
  animateNum('stat-a', t.filter(x=>x.grade==='A').length);
  animateNum('stat-b', t.filter(x=>x.grade==='B').length);
  animateNum('stat-avg', avg);
  animateNum('stat-alerts', allAlerts.length);
}

function animateNum(id, target) {
  const el = document.getElementById(id);
  if (!el) return;
  const current = parseInt(el.textContent) || 0;
  if (current === target) return;
  const step = (target - current) / 15;
  let val = current;
  const tick = () => {
    val += step;
    el.textContent = Math.round(val);
    if (Math.abs(val - target) > 0.5) requestAnimationFrame(tick);
    else el.textContent = target;
  };
  requestAnimationFrame(tick);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openModal(address) {
  const t = allTokens.find(x => x.address === address);
  if (!t) return;
  const gc = gradeColor(t.grade);
  document.getElementById('modal-content').innerHTML = `
    <div class="modal-header">
      <div class="modal-token-row">
        ${t.image_url ? `<img src="${t.image_url}" style="width:48px;height:48px;border-radius:50%;border:1px solid ${gc}20" onerror="this.style.display='none'">` : ''}
        <div class="modal-grade ${t.grade}">${t.grade}</div>
        <div>
          <div class="modal-symbol">${esc(t.symbol||'???')}</div>
          <div class="modal-name">${esc(t.name||'Unknown')}</div>
          <div class="modal-address">${t.address?.slice(0,24)}...${t.address?.slice(-8)}</div>
        </div>
      </div>
    </div>
    <div class="modal-score-section">
      <div class="modal-score-header">
        <span class="modal-score-label">SIGNAL SCORE</span>
        <span class="modal-score-value" style="color:${gc}">${t.score}/100</span>
      </div>
      <div class="modal-score-track">
        <div class="modal-score-fill" style="width:0%;background:${gc}" id="msf"></div>
      </div>
    </div>
    <div class="modal-flags">${renderFlags(t.flags, false, true)}</div>
    <div class="modal-stats">
      ${[
        ['PRICE', fmtPrice(t.price_usd)],
        ['5M CHANGE', fmtChg(t.price_change_5m), chgColor(t.price_change_5m)],
        ['1H CHANGE', fmtChg(t.price_change_1h), chgColor(t.price_change_1h)],
        ['FDV', fmtLarge(t.fdv)],
        ['LIQUIDITY', fmtLarge(t.liquidity_usd)],
        ['VOL 1H', fmtLarge(t.volume_1h)],
        ['BUYS 5M', t.buys_5m||0, 'var(--green)'],
        ['SELLS 5M', t.sells_5m||0, 'var(--red)'],
        ['BUY RATIO', `${((t.buy_ratio_5m||0.5)*100).toFixed(0)}%`],
        ['HOLDERS', t.holder_count||'?'],
        ['TOP 10%', `${(t.top10_pct||0).toFixed(1)}%`],
        ['SMART $', t.smart_money_count||0, t.smart_money_count > 0 ? '#a78bfa' : null],
      ].map(([label, val, color]) => `
        <div class="modal-stat">
          <div class="modal-stat-label">${label}</div>
          <div class="modal-stat-value" style="color:${color||'#c8e8f8'}">${val}</div>
        </div>
      `).join('')}
    </div>
    <div class="modal-links">
      <a class="modal-link" href="https://pump.fun/${t.address}" target="_blank">üîó PUMP.FUN</a>
      <a class="modal-link" href="${t.dex_url||`https://dexscreener.com/solana/${t.address}`}" target="_blank">üìä DEXSCREENER</a>
      <a class="modal-link" href="https://solscan.io/token/${t.address}" target="_blank">üîé SOLSCAN</a>
      <a class="modal-link" href="https://birdeye.so/token/${t.address}?chain=solana" target="_blank">üëÅ BIRDEYE</a>
    </div>
  `;
  document.getElementById('modal-overlay').classList.add('open');
  setTimeout(() => {
    const fill = document.getElementById('msf');
    if (fill) fill.style.width = t.score + '%';
  }, 100);
}

function closeModal(e) {
  if (!e || e.target === document.getElementById('modal-overlay') || e.currentTarget.tagName === 'BUTTON') {
    document.getElementById('modal-overlay').classList.remove('open');
  }
}
document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOAST NOTIFICATIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showToast(token) {
  if (token.grade !== 'S' && token.grade !== 'A') return;
  const container = document.getElementById('toast-container');
  const toast = document.createElement('div');
  toast.className = `toast grade-${token.grade}`;
  toast.innerHTML = `${token.grade === 'S' ? 'üö®' : '‚ö°'} [${token.grade}] ${esc(token.symbol||'???')} ‚Äî ${token.score}/100`;
  container.appendChild(toast);
  setTimeout(() => toast.remove(), 4000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function gradeColor(g) {
  return { S: 'var(--orange)', A: 'var(--yellow)', B: 'var(--cyan)', C: '#334455' }[g] || '#888';
}
function chgClass(v) { return v > 0 ? 'pos' : v < 0 ? 'neg' : 'neu'; }
function chgColor(v) { return v > 0 ? 'var(--green)' : v < 0 ? 'var(--red)' : 'rgba(200,232,248,0.4)'; }
function fmtChg(v) { if (!v) return '0.0%'; return `${v>0?'+':''}${Number(v).toFixed(1)}%`; }

function fmtPrice(p) {
  if (!p) return '$0';
  if (p < 0.000001) return '$' + Number(p).toExponential(2);
  if (p < 0.001)    return '$' + Number(p).toFixed(8);
  if (p < 1)        return '$' + Number(p).toFixed(6);
  return '$' + Number(p).toFixed(4);
}
function fmtLarge(n) {
  if (!n) return '$0';
  if (n >= 1e9) return '$' + (n/1e9).toFixed(1) + 'B';
  if (n >= 1e6) return '$' + (n/1e6).toFixed(1) + 'M';
  if (n >= 1e3) return '$' + (n/1e3).toFixed(1) + 'K';
  return '$' + Math.round(n);
}
function fmtAge(ts) {
  if (!ts) return '?';
  const m = Math.floor((Date.now() - new Date(ts)) / 60000);
  if (m < 60) return m + 'm';
  if (m < 1440) return Math.floor(m/60) + 'h';
  return Math.floor(m/1440) + 'd';
}
function isUltraFresh(ts) {
  if (!ts) return false;
  return (Date.now() - new Date(ts)) < 10 * 60000;
}
function fmtTimeAgo(ts) {
  if (!ts) return '?';
  const m = Math.floor((Date.now() - new Date(ts)) / 60000);
  if (m < 1) return 'just now';
  if (m < 60) return m + 'm ago';
  return Math.floor(m/60) + 'h ago';
}
function esc(s) {
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

const FLAG_CLASSES = {
  SMART_MONEY: 'flag-smart',
  STRONG_BUY: 'flag-buy', MODERATE_BUY: 'flag-buy', ORGANIC_BUYS: 'flag-buy', HIGH_ORGANIC: 'flag-buy',
  EXPLOSION: 'flag-surge', SURGE: 'flag-surge', PUMP: 'flag-surge', ULTRA_EARLY: 'flag-surge',
  STRONG_LIQUIDITY: 'flag-safe', DECENT_LIQUIDITY: 'flag-safe', HAS_TWITTER: 'flag-safe',
};
function getFlagClass(flag) {
  for (const [key, cls] of Object.entries(FLAG_CLASSES)) {
    if (flag.includes(key)) return cls;
  }
  return 'flag-default';
}
function renderFlags(flags, small = false, large = false) {
  if (!flags?.length) return '';
  const limit = large ? 8 : small ? 3 : 4;
  return (flags || []).slice(0, limit).map(f =>
    `<span class="flag ${getFlagClass(f)}" style="${large ? 'font-size:10px;padding:3px 8px' : ''}">${f.replace(/_/g,' ')}</span>`
  ).join('');
}
</script>
</body>
</html>
